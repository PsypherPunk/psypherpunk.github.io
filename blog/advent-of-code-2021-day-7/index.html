<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#9a9996 name=theme-color><meta content=#20c20e media=(prefers-color-scheme:dark) name=theme-color><title>Ô∏èüéÑ Advent of Code 2021, Day 7 - psypherpunk::blog</title><link href=https://blog.psypherpunk.io/blog/advent-of-code-2021-day-7/ rel=canonical><link href=https://blog.psypherpunk.io/favicon.png rel=icon type=image/png><link href=https://blog.psypherpunk.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="psypherpunk::blog - RSS Feed" href=https://blog.psypherpunk.io/rss.xml rel=alternate type=application/rss+xml><link title="psypherpunk::blog - Atom Feed" href=https://blog.psypherpunk.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#6f8396}[data-theme=dark]{--accent-color:#20c20e}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#20c20e}}</style><link href=https://blog.psypherpunk.io/style.css rel=stylesheet><script defer src=https://blog.psypherpunk.io/closable.js></script><meta content=psypherpunk::blog property=og:site_name><meta content="Ô∏èüéÑ Advent of Code 2021, Day 7 - psypherpunk::blog" property=og:title><meta content=https://blog.psypherpunk.io/blog/advent-of-code-2021-day-7/ property=og:url><meta content="The Treachers of Whales" property=og:description><meta content=https://blog.psypherpunk.io/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://blog.psypherpunk.io> <i class=icon></i>psypherpunk::blog</a><li class=divider><li><a href=https://blog.psypherpunk.io/blog/>Blog</a><li id=feed><details class=closable><summary class=circle title=Feed><i class=icon></i></summary> <ul><li><a href=https://blog.psypherpunk.io/rss.xml>RSS</a><li><a href=https://blog.psypherpunk.io/atom.xml>Atom</a></ul></details></ul></nav></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2022-08-27T00:00:00+00:00">Published on August 27, 2022</time></small><h1>Ô∏èüéÑ Advent of Code 2021, Day 7</h1><ul class=tags><li><a class=tag href=https://blog.psypherpunk.io/tags/rust/>rust</a><li><a class=tag href=https://blog.psypherpunk.io/tags/advent-of-code/>advent-of-code</a></ul><ul class=tags><li><a class=tag href=https://blog.psypherpunk.io/categories/advent-of-code/>advent-of-code</a></ul></div><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><h2 id=day-7-the-treachery-of-whales><a href=https://adventofcode.com/2021/day/7>Day 7: The Treachery of Whales</a></h2><p>While I‚Äôve completed every star for each year of <a href=https://adventofcode.com/><em>Advent of Code</em></a>, I recently realised I hadn‚Äôt written up my notes from some of the days from last year. Taking the opportunity to revisit my efforts, here‚Äôs the first missing day from 2021, along with some obvervations as to where I fundamentally misunderstood the input data.</p><span id=continue-reading></span><h3 id=part-one>Part One</h3><p>This is not an auspicious start: looking back at this from the far future of 2022, I‚Äôm not actually sure that I did this correctly (or at least not efficiently.)<p>Parsing the input is straightforward enough (note we‚Äôre using <code>isize</code> as we‚Äôll be doing some subtracting later and this makes it much simpler; similarly, I opted to use a <code>flat_map()</code> which will drop any <code>Err</code> which come from failed parsing, a bad practice I‚Äôll likely revisit in the future):<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span style=color:#b48ead>fn </span><span style=color:#8fa1b3>get_positions</span><span>(</span><span style=color:#bf616a>input</span><span>: &</span><span style=color:#b48ead>str</span><span>) -> Vec&lt;</span><span style=color:#b48ead>isize</span><span>> {
</span><span>    input
</span><span>        .</span><span style=color:#96b5b4>trim</span><span>()
</span><span>        .</span><span style=color:#96b5b4>split</span><span>('</span><span style=color:#a3be8c>,</span><span>')
</span><span>        .</span><span style=color:#96b5b4>flat_map</span><span>(|</span><span style=color:#bf616a>pos</span><span>| pos.parse::&lt;</span><span style=color:#b48ead>isize</span><span>>())
</span><span>        .</span><span style=color:#96b5b4>collect</span><span>()
</span><span>}
</span></code></pre><p>This was the solution I came up with for <em>Part One</em>:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span style=color:#b48ead>pub fn </span><span style=color:#8fa1b3>get_part_one</span><span>(</span><span style=color:#bf616a>input</span><span>: &</span><span style=color:#b48ead>str</span><span>) -> </span><span style=color:#b48ead>isize </span><span>{
</span><span>    </span><span style=color:#b48ead>let</span><span> positions = </span><span style=color:#96b5b4>get_positions</span><span>(input);
</span><span>
</span><span>    (</span><span style=color:#d08770>0</span><span>..positions.</span><span style=color:#96b5b4>len</span><span>())
</span><span>        .</span><span style=color:#96b5b4>map</span><span>(|</span><span style=color:#bf616a>alignment</span><span>| {
</span><span>            positions
</span><span>                .</span><span style=color:#96b5b4>iter</span><span>()
</span><span>                .</span><span style=color:#96b5b4>map</span><span>(|</span><span style=color:#bf616a>position</span><span>| (position - alignment as </span><span style=color:#b48ead>isize</span><span>).</span><span style=color:#96b5b4>abs</span><span>())
</span><span>                .</span><span style=color:#96b5b4>sum</span><span>()
</span><span>        })
</span><span>        .</span><span style=color:#96b5b4>min</span><span>()
</span><span>        .</span><span style=color:#96b5b4>unwrap</span><span>()
</span><span>}
</span></code></pre><p>While this <em>worked</em>, there are (at least) two things wrong with it:<ul><li>I‚Äôm looping over the input and then determining the fuel consumption for each other position. However, even in the example given there are duplicates so the outer loop will repeat unecessarily.<li>I‚Äôm not even looping over the right thing! I‚Äôm looping over the input‚Äôs <em>length</em>, not the actual values therein: it‚Äôs pure coincidence that all the positions listed therein actually fall in that range.</ul><p>Assuming that that initial loop is instead <code>positions.map(‚Ä¶</code>, there are 1,000 crabs coming to aid us but only 667 unique positions so there are definitely efficiencies to be made.<h3 id=part-two>Part Two</h3><p>There‚Äôs one further assumption I made in the first part that doesn‚Äôt hold true here: that the correct position is actually represented in the input.<p>Take the input of <code>16,1,2,0,4,2,7,1,2,14</code>: the answer is <code>5</code> which is not present in that list. Instead, the range of positions should be from the <em>minimum</em> up to the <em>maximum</em> value represented in that list (I <em>think</em> we can safely assume that moving the crabs outside of that range would take more fuel than moving within that range.)<p>It‚Äôs more verbose but instead I should have something more like:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>    </span><span style=color:#b48ead>let</span><span> min = positions.</span><span style=color:#96b5b4>iter</span><span>().</span><span style=color:#96b5b4>min</span><span>().</span><span style=color:#96b5b4>unwrap</span><span>();
</span><span>    </span><span style=color:#b48ead>let</span><span> max = positions.</span><span style=color:#96b5b4>iter</span><span>().</span><span style=color:#96b5b4>max</span><span>().</span><span style=color:#96b5b4>unwrap</span><span>();
</span><span>    (*min..=*max)
</span><span>        .</span><span style=color:#96b5b4>map</span><span>(‚Ä¶
</span></code></pre><p>Here I originally did the calculation of the fuel consumption via this (<code>diff</code> being the distance moved):<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>(diff * (diff + </span><span style=color:#d08770>1</span><span>)) / </span><span style=color:#d08770>2
</span></code></pre><p>However, now looking at it, I‚Äôm not ever sure I understand it at first glance (though thankfully I left myself a note about this being a <a href=https://en.wikipedia.org/wiki/Arithmetic_progression><em>Arithmetic progression</em></a>.) Instead, I could have opted to do this:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>(</span><span style=color:#d08770>0</span><span>..=diff).</span><span style=color:#96b5b4>sum</span><span>()
</span></code></pre><p>That (now, at least) makes more sense to me: the fuel consumed is the sum of the <em>range</em> between the two (i.e. 1 + 2 + 3, etc.)<p>Furthermore, I don‚Äôt even need that <code>sum()</code>: I don‚Äôt care about the sum of each individual crab‚Äôs movements, just the sum of <em>all</em> the crabs‚Äô movements:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span>.</span><span style=color:#96b5b4>flat_map</span><span>(|</span><span style=color:#bf616a>position</span><span>| {
</span><span>    </span><span style=color:#b48ead>let</span><span> diff = (position - alignment).</span><span style=color:#96b5b4>abs</span><span>();
</span><span>    </span><span style=color:#d08770>0</span><span>..=diff
</span><span>})
</span><span>.</span><span style=color:#96b5b4>sum</span><span>()
</span></code></pre><p>So my final solution for the second part ends up being:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span style=color:#b48ead>pub fn </span><span style=color:#8fa1b3>get_part_two</span><span>(</span><span style=color:#bf616a>input</span><span>: &</span><span style=color:#b48ead>str</span><span>) -> </span><span style=color:#b48ead>isize </span><span>{
</span><span>    </span><span style=color:#b48ead>let</span><span> positions = </span><span style=color:#96b5b4>get_positions</span><span>(input);
</span><span>
</span><span>    </span><span style=color:#b48ead>let</span><span> min = positions.</span><span style=color:#96b5b4>iter</span><span>().</span><span style=color:#96b5b4>min</span><span>().</span><span style=color:#96b5b4>unwrap</span><span>();
</span><span>    </span><span style=color:#b48ead>let</span><span> max = positions.</span><span style=color:#96b5b4>iter</span><span>().</span><span style=color:#96b5b4>max</span><span>().</span><span style=color:#96b5b4>unwrap</span><span>();
</span><span>    (*min..=*max)
</span><span>        .</span><span style=color:#96b5b4>map</span><span>(|</span><span style=color:#bf616a>alignment</span><span>| {
</span><span>            positions
</span><span>                .</span><span style=color:#96b5b4>iter</span><span>()
</span><span>                .</span><span style=color:#96b5b4>flat_map</span><span>(|</span><span style=color:#bf616a>position</span><span>| {
</span><span>                    </span><span style=color:#d08770>0</span><span>..=(position - alignment).</span><span style=color:#96b5b4>abs</span><span>()
</span><span>                })
</span><span>                .</span><span style=color:#96b5b4>sum</span><span>()
</span><span>        })
</span><span>        .</span><span style=color:#96b5b4>min</span><span>()
</span><span>        .</span><span style=color:#96b5b4>unwrap</span><span>()
</span><span>}
</span></code></pre><p>Curiously, the <code>cargo run</code> for <em>Part Two</em> takes an extraordinarily long time (to the point I lose patience waiting for it to finish); using <code>cargo run --release</code>, however, is single-digit milliseconds. I‚Äôm aware of the differences between the two, the extent of the difference for such a seemingly straightforward problem is surprising.</article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=https://blog.psypherpunk.io/blog/dialed-up-ctf/> <div class=nav-arrow>Previous</div> <span class=post-title>Ô∏èüè¥ Dialed Up CTF</span> </a><a class="post-nav-item post-nav-next" href=https://blog.psypherpunk.io/blog/advent-of-code-2021-day-9/> <div class=nav-arrow>Next</div> <span class=post-title>Ô∏èüéÑ Advent of Code 2021, Day 9</span> </a></nav></main><footer id=site-footer><nav><ul><li><a href=https://blog.psypherpunk.io/blog/>Blog</a></ul></nav><p>¬© 2025 PsypherPunk<ul id=socials><li><a rel=" me" href=https://github.com/PsypherPunk title=GitHub> <i style="--icon:url(&#34;data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34;)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://hachyderm.io/@psypherpunk title=Mastodon> <i style="--icon:url(&#34;data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EMastodon%3C/title%3E%3Cpath d='M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z'/%3E%3C/svg%3E&#34;)" class=icon></i> <span>Mastodon</span> </a><li><a rel=" me" href=https://twitter.com/PsypherPunk title=Twitter> <i style="--icon:url(&#34;data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ETwitter%3C/title%3E%3Cpath d='M21.543 7.104c.015.211.015.423.015.636 0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041 4.93 4.93 0 0 1-4.6-3.42 4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148 13.98 13.98 0 0 0 11.82 8.292a4.929 4.929 0 0 1 8.39-4.49 9.868 9.868 0 0 0 3.128-1.196 4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549z'/%3E%3C/svg%3E&#34;)" class=icon></i> <span>Twitter</span> </a></ul></footer>