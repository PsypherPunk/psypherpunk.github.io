<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#9a9996 name=theme-color><meta content=#20c20e media=(prefers-color-scheme:dark) name=theme-color><title>ü¶Ñ django-pwny - psypherpunk::blog</title><link href=https://blog.psypherpunk.io/blog/django-pwny/ rel=canonical><link href=https://blog.psypherpunk.io/favicon.png rel=icon type=image/png><link href=https://blog.psypherpunk.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="psypherpunk::blog - RSS Feed" href=https://blog.psypherpunk.io/rss.xml rel=alternate type=application/rss+xml><link title="psypherpunk::blog - Atom Feed" href=https://blog.psypherpunk.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#6f8396}[data-theme=dark]{--accent-color:#20c20e}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#20c20e}}</style><link href=https://blog.psypherpunk.io/style.css rel=stylesheet><script defer src=https://blog.psypherpunk.io/closable.js></script><meta content=psypherpunk::blog property=og:site_name><meta content="ü¶Ñ django-pwny - psypherpunk::blog" property=og:title><meta content=https://blog.psypherpunk.io/blog/django-pwny/ property=og:url><meta content="A look at password handling in light of changes to the NIST guidelines." property=og:description><meta content=https://blog.psypherpunk.io/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://blog.psypherpunk.io> <i class=icon></i>psypherpunk::blog</a><li class=divider><li><a href=https://blog.psypherpunk.io/blog/>Blog</a><li id=feed><details class=closable><summary class=circle title=Feed><i class=icon></i></summary> <ul><li><a href=https://blog.psypherpunk.io/rss.xml>RSS</a><li><a href=https://blog.psypherpunk.io/atom.xml>Atom</a></ul></details></ul></nav></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2018-08-29T00:00:00+00:00">Published on August 29, 2018</time></small><h1>ü¶Ñ django-pwny</h1><ul class=tags><li><a class=tag href=https://blog.psypherpunk.io/categories/python/>python</a></ul><ul class=tags><li><a class=tag href=https://blog.psypherpunk.io/tags/django/>django</a><li><a class=tag href=https://blog.psypherpunk.io/tags/python/>python</a><li><a class=tag href=https://blog.psypherpunk.io/tags/security/>security</a></ul></div><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><blockquote><p><em>Originally published at <a href=https://www.thedatashed.co.uk/2019/02/07/django-pwny/>The Data Shed</a>.</em></blockquote><span id=continue-reading></span><p>Much as we might lament their continued use, passwords are an important part of modern life. A part that seems only to be increasing in ubiquity; as I sit here I can see at least half a dozen devices, from this laptop to my television, that each require an inordinate number of passwords to keep them from turning into little more than novelty paperweights.<p>So let‚Äôs take an inexplicable foray into the fun we have managing our little <em>‚Äúmemorized secrets‚Äù</em>‚Ä¶<h2 id=nist-national-institute-of-standards-and-technology>NIST: National Institute of Standards and Technology</h2><h3 id=nist-special-publication-800-63>NIST Special Publication 800-63</h3><p>I‚Äôm sure that many are intimately familiar with <em>NIST Special Publication 800-63. Appendix A</em>, by Bill Burr. Well, if not the document itself then at least its consequences. Therein, amidst discussions of Claude Shannon‚Äôs work on entropy in information systems, he outlined what effectively became the de facto best practices for password generation for over a decade, asking us to consider:<blockquote><ul><li><em>a minimum of 8 character passwords, selected by subscribers from an alphabet of 94 printable characters,</em><li><em>required subscribers to include at least one upper case letter, one lower case letter, one number and one special character, and;</em><li><em>Used a dictionary to prevent subscribers from including common words and prevented permutations of the username as a password.</em></ul></blockquote><p>He recently had this to say on the subject:<blockquote><p><em>‚ÄúMuch of what I did I now regret. It just drives people bananas and they don‚Äôt pick good passwords no matter what you do.‚Äù</em></blockquote><p>He‚Äôs not wrong, is he.<h3 id=nist-special-publication-800-63b>NIST Special Publication 800-63B</h3><p>Released in June 2017, the latest NIST guidelines make some surprising (or perhaps not so surprising) changes. Certainly it‚Äôs a significantly lengthier document, given the weight of the task at hand and there‚Äôs a definite <em>formality</em> to the language this time around. Perhaps the biggest change is a more general recognition that passwords themselves aren‚Äôt enough.<p>Some of the more significant things to note:<ul><li>Gone are the periodic password changes (<em>‚ÄúVerifiers SHOULD NOT require memorized secrets to be changed arbitrarily (e.g., periodically)‚Äù</em>).<li>Gone is the convoluted alphanumeric-song-and-dance (<em>‚ÄúVerifiers SHOULD NOT impose other composition rules (e.g., requiring mixtures of different character types or prohibiting consecutively repeated characters) for memorized secrets‚Äù</em>).</ul><p>Oh, and for all you sites that won‚Äôt let me paste my password: <em>‚ÄúVerifiers SHOULD permit claimants to use ‚Äúpaste‚Äù functionality when entering a memorized secret‚Äú</em>!<p>Most noteworthy of all (at least in the context of my writing this), there‚Äôs this little nugget from section 5.1.1.2:<blockquote><p><em>When processing requests to establish and change memorized secrets, verifiers SHALL compare the prospective secrets against a list that contains values known to be commonly-used, expected, or compromised. For example, the list MAY include, but is not limited to:</em><ul><li><em>Passwords obtained from previous breach corpuses.</em><li><em>Dictionary words.</em><li><em>Repetitive or sequential characters (e.g. ‚Äòaaaaaa‚Äô, ‚Äò1234abcd‚Äô).</em><li><em>Context-specific words, such as the name of the service, the username, and derivatives thereof.</em></ul></blockquote><p>What‚Äôs that? <em>‚ÄúPasswords obtained from previous breach corpuses‚Äù</em> you say?<h2 id=have-i-been-pwned>‚Äô;‚Äìhave i been pwned?</h2><p>Launched in 2013, the site <a href=https://haveibeenpwned.com/><em>Have I Been Pwned?</em></a> stores and processes data acquired from <em>breaches</em>, typically when said data are exposed publicly or some attempt is made to profit therefrom, in some from the Web‚Äôs more insidious locales. It‚Äôs a matter the site‚Äôs creator, Troy Hunt, can better <a href=https://haveibeenpwned.com/About>explain</a> but the part most interesting to this particular topic is the fact that it exposes an <a href=https://haveibeenpwned.com/API/v2>API</a>.<p>Specifically, the API allows us to send it a password and check whether it has appeared in a previous data breach, thus fulfilling the <em>‚Äúprevious breach corpuses‚Äù</em> part of the NIST guidelines.<p>Obviously, sending your password across the Web to <em>any</em> third-party service is Not A Very Good Thing To Do‚Ñ¢ and thankfully the API‚Äôs design takes this into account: the password isn‚Äôt sent directly, we instead send a cryptographic hash derived from the password. Nor do we send the entire hash, instead passing only the first five characters.<p>The data returned from the API comprise a list of matching hash suffixes and number of occurrences of that hash within the corpus.<h3 id=perhaps-a-demonstration>Perhaps a demonstration?</h3><p>Let‚Äôs say we have a password, a truly terrible password that no one would ever use:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>BAD_PASSWORD</span><span>="</span><span style=color:#a3be8c>password</span><span>"
</span></code></pre><p>No one would ever be silly enough to use that, right? So, purely for demonstration purposes as <em>no one would ever have this password</em>, we calculate the SHA1:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>$</span><span> BAD_PASSWORD_HASH=$(
</span><span>    </span><span style=color:#96b5b4>echo </span><span style=color:#bf616a>-n </span><span>${</span><span style=color:#bf616a>BAD_PASSWORD</span><span>} | \
</span><span>        </span><span style=color:#bf616a>sha1sum </span><span>| \
</span><span>        </span><span style=color:#bf616a>cut -d </span><span>' '</span><span style=color:#bf616a> -f1 </span><span>| \
</span><span>        </span><span style=color:#bf616a>tr </span><span>'</span><span style=color:#a3be8c>[:lower:]</span><span>' '</span><span style=color:#a3be8c>[:upper:]</span><span>'
</span><span>)
</span></code></pre><p>Now we have a cryptographic hash of a password that <em>no one would ever use ‚Äôcause that would be silly</em> and can send the first five characters to the the <em>Have I Been Pwned</em> API:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>$</span><span> curl "</span><span style=color:#a3be8c>https://api.pwnedpasswords.com/range/</span><span>$</span><span style=color:#a3be8c>{</span><span style=color:#bf616a>BAD_PASSWORD_HASH</span><span>:</span><span style=color:#d08770>0</span><span>:</span><span style=color:#d08770>5</span><span style=color:#a3be8c>}</span><span>"
</span><span style=color:#bf616a>003D68EB55068C33ACE09247EE4C639306B:3
</span><span style=color:#bf616a>012C192B2F16F82EA0EB9EF18D9D539B0DD:1
</span><span style=color:#bf616a>01330C689E5D64F660D6947A93AD634EF8F:1
</span><span style=color:#bf616a>0198748F3315F40B1A102BF18EEA0194CD9:1
</span><span style=color:#bf616a>01F9033B3C00C65DBFD6D1DC4D22918F5E9:2
</span><span style=color:#bf616a>0424DB98C7A0846D2C6C75E697092A0CC3E:5
</span><span style=color:#bf616a>047F229A81EE2747253F9897DA38946E241:1
</span><span style=color:#bf616a>04A37A676E312CC7C4D236C93FBD992AA3C:5
</span><span style=color:#bf616a>...
</span></code></pre><p>Well that‚Äôs a lot of results, 511 in fact (at time of writing). Of course, that doesn‚Äôt mean that our password is actually in that list‚Äî<em>because, of course, no one would ever use it</em>‚Äîbut we can double-check by seeing if the suffix from our SHA1 is in the list:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>$</span><span> curl "</span><span style=color:#a3be8c>https://api.pwnedpasswords.com/range/</span><span>$</span><span style=color:#a3be8c>{</span><span style=color:#bf616a>BAD_PASSWORD_HASH</span><span>:</span><span style=color:#d08770>0</span><span>:</span><span style=color:#d08770>5</span><span style=color:#a3be8c>}</span><span>" | \
</span><span>    </span><span style=color:#bf616a>grep </span><span>${</span><span style=color:#bf616a>BAD_PASSWORD_HASH</span><span>:</span><span style=color:#d08770>5</span><span>:}
</span><span style=color:#bf616a>1E4C9B93F3F0682250B6CF8331B7EE68FD8:3645804
</span></code></pre><p>Oh. Oh dear. So <code>password</code> has been used as a password and found in no fewer than 3,645,804 known data breaches? Burr was right, <em>‚Äúthey don‚Äôt pick good passwords no matter what you do‚Äù</em>.<h2 id=django>Django</h2><p>To perhaps give a more practical demonstration of how this might be integrated into a functioning site, I‚Äôm going to look to <a href=https://www.djangoproject.com/>Django</a>. Password validation was <a href=https://docs.djangoproject.com/en/1.9/topics/auth/passwords/#module-django.contrib.auth.password_validation>introduced in 1.9</a> and essentially comprises a list of <em>validators</em>‚Äîobjects with a <code>validate()</code> method‚Äîinto each of which is passed the incoming password.<p>Of course, passwords aren‚Äôt stored so there are only two points at which you can do this:<ul><li>User registration, where potentially you can protect users from using at-risk passwords.<li>Login, at which point you can merely warn users about the potential risk.</ul><p>To perhaps put the escalating problem of password management into perspective, in version 1.9 (December 2015) Django‚Äôs <code>CommonPasswordValidator</code> contained a list of 1,000 commonly-used passwords. By version 2.1 (August 2018) it had grown to 20,000.<h3 id=pwny-validators-haveibeenpwnedvalidator><code>pwny.validators.HaveIBeenPwnedValidator</code></h3><p>Here‚Äôs a quick implementation, hereby dubbed <code>django-pwny</code> (and hence the ridiculous title of this post):<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span style=color:#b48ead>class </span><span style=color:#ebcb8b>HaveIBeenPwnedValidator</span><span style=color:#eff1f5>:
</span><span>
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>validate</span><span>(</span><span style=color:#bf616a>self</span><span>, </span><span style=color:#bf616a>password</span><span>, </span><span style=color:#bf616a>user</span><span>=</span><span style=color:#d08770>None</span><span>):
</span><span>        sha1 = hashlib.</span><span style=color:#bf616a>sha1</span><span>()
</span><span>        sha1.</span><span style=color:#bf616a>update</span><span>(password.</span><span style=color:#bf616a>encode</span><span>())
</span><span>        digest = sha1.</span><span style=color:#bf616a>hexdigest</span><span>().</span><span style=color:#bf616a>upper</span><span>()
</span><span>        prefix = digest[:</span><span style=color:#d08770>5</span><span>]
</span><span>        url = </span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>https://api.pwnedpasswords.com/range/</span><span>{prefix}"
</span><span>        r = requests.</span><span style=color:#bf616a>get</span><span>(url, </span><span style=color:#bf616a>headers</span><span>={"</span><span style=color:#a3be8c>User-Agent</span><span>": "</span><span style=color:#a3be8c>django-pwny</span><span>"})
</span><span>        </span><span style=color:#b48ead>for </span><span>suffix_count </span><span style=color:#b48ead>in </span><span>r.text.</span><span style=color:#bf616a>splitlines</span><span>():
</span><span>            suffix, count = suffix_count.</span><span style=color:#bf616a>split</span><span>("</span><span style=color:#a3be8c>:</span><span>")
</span><span>            </span><span style=color:#b48ead>if </span><span>digest == </span><span style=color:#b48ead>f</span><span>"{prefix}{suffix}":
</span><span>                </span><span style=color:#b48ead>raise </span><span style=color:#bf616a>ValidationError</span><span>(
</span><span>                    </span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Your password has been pwned </span><span>{count}</span><span style=color:#a3be8c> times!</span><span>"
</span><span>                )
</span><span>
</span><span>    </span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>get_help_text</span><span>(</span><span style=color:#bf616a>self</span><span>):
</span><span>        </span><span style=color:#b48ead>return </span><span>(
</span><span>            "</span><span style=color:#a3be8c>Your password should not appear in a list of compromised</span><span>"
</span><span>            "</span><span style=color:#a3be8c>passwords.</span><span>"
</span><span>        )
</span></code></pre><p>While I‚Äôm sure there‚Äôs room for improvement, added to the <code>settings.py</code> file, it should allow users to be alerted should their chosen password be a little too <em>common</em>:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span style=color:#bf616a>AUTH_PASSWORD_VALIDATORS </span><span>= [
</span><span>    {
</span><span>        "</span><span style=color:#a3be8c>NAME</span><span>": "</span><span style=color:#a3be8c>pwny.validators.HaveIBeenPwnedValidator</span><span>",
</span><span>    },
</span><span>]
</span></code></pre><p>So there it is: a way, in accordance with the latest NIST guidelines, to compare users‚Äô passwords against a substantial list of known breaches. Quite whether this particular recommendation will see widespread adoption, we‚Äôll have to wait and see.<p>Shortly after I drafted this, GitHub decided to <a href=https://blog.github.com/2018-07-31-new-improvements-and-best-practices-for-account-security-and-recoverability/#enforcing-stronger-passwords>get in on the act</a>. While that‚Äôs definitely a major voice in the industry following the guidelines, they‚Äôre definitely in the minority.<h2 id=references>References</h2><ul><li><a href=https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf>NIST Special Publication 800-63B</a><li><a href=https://csrc.nist.gov/CSRC/media/Publications/sp/800-63/ver-10/archive/2004-06-30/documents/sp800-63-v1-0.pdf>NIST Special Publication 800-63</a><li><em>Talk Python to Me</em>, <a href=https://talkpython.fm/episodes/show/136/secure-code-lessons-from-have-i-been-pwned>Episode 136</a>.</ul></article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=https://blog.psypherpunk.io/blog/hello-world/> <div class=nav-arrow>Previous</div> <span class=post-title>üéâ Hello, World!</span> </a><a class="post-nav-item post-nav-next" href=https://blog.psypherpunk.io/blog/go-down-the-rabbit-hole/> <div class=nav-arrow>Next</div> <span class=post-title>üêõ Go Down the Rabbit Hole</span> </a></nav></main><footer id=site-footer><nav><ul><li><a href=https://blog.psypherpunk.io/blog/>Blog</a></ul></nav><p>¬© 2025 PsypherPunk<ul id=socials><li><a rel=" me" href=https://github.com/PsypherPunk title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://hachyderm.io/@psypherpunk title=Mastodon> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EMastodon%3C/title%3E%3Cpath d='M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Mastodon</span> </a><li><a rel=" me" href=https://twitter.com/PsypherPunk title=Twitter> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ETwitter%3C/title%3E%3Cpath d='M21.543 7.104c.015.211.015.423.015.636 0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041 4.93 4.93 0 0 1-4.6-3.42 4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148 13.98 13.98 0 0 0 11.82 8.292a4.929 4.929 0 0 1 8.39-4.49 9.868 9.868 0 0 0 3.128-1.196 4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Twitter</span> </a></ul></footer>